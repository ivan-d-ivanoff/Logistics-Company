{% extends "base_app.html" %}

{% block title %}Client Dashboard{% endblock %}
{% block page %}dashboard{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="h3 mb-1">Client Dashboard</h1>
    <p class="text-muted mb-0">Welcome, {{ request.user.first_name }} {{ request.user.last_name }} ({{ request.user.email }})</p>
  </div>
</div>

<!-- Sent Parcels -->
<div class="card border-0 shadow-sm mb-4">
  <div class="card-header bg-white py-3">
    <h5 class="card-title mb-0"><i class="bi bi-send me-2"></i>Sent Parcels</h5>
    <small class="text-muted">Parcels you have sent</small>
  </div>
  <div class="card-body p-0">
    {% if sent_parcels %}
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>Tracking #</th>
            <th>Receiver</th>
            <th>From</th>
            <th>To</th>
            <th>Status</th>
            <th>Created</th>
            <th>Delivered</th>
          </tr>
        </thead>
        <tbody>
          {% for parcel in sent_parcels %}
          <tr>
            <td><code>{{ parcel.tracking_number }}</code></td>
            <td>{{ parcel.receiver.first_name }} {{ parcel.receiver.last_name }}</td>
            <td>{{ parcel.sender_office|default:"-" }}</td>
            <td>{{ parcel.receiver_office|default:"-" }}</td>
            <td>
              {% if parcel.current_status.code == "DELIVERED" %}
                <span class="badge bg-success">{{ parcel.current_status }}</span>
              {% elif parcel.current_status.code == "CANCELLED" or parcel.current_status.code == "RETURNED" %}
                <span class="badge bg-danger">{{ parcel.current_status }}</span>
              {% elif parcel.current_status.code == "IN_TRANSIT" or parcel.current_status.code == "OUT_FOR_DELIVERY" %}
                <span class="badge bg-primary">{{ parcel.current_status }}</span>
              {% else %}
                <span class="badge bg-secondary">{{ parcel.current_status }}</span>
              {% endif %}
            </td>
            <td>{{ parcel.created_at|date:"Y-m-d H:i" }}</td>
            <td>{{ parcel.delivered_at|date:"Y-m-d H:i"|default:"-" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="text-center text-muted py-4">
      <i class="bi bi-inbox fs-1 d-block mb-2"></i>
      <p class="mb-0">You haven't sent any parcels yet.</p>
    </div>
    {% endif %}
  </div>
</div>

<!-- Received Parcels -->
<div class="card border-0 shadow-sm">
  <div class="card-header bg-white py-3">
    <h5 class="card-title mb-0"><i class="bi bi-inbox me-2"></i>Received Parcels</h5>
    <small class="text-muted">Parcels sent to you</small>
  </div>
  <div class="card-body p-0">
    {% if received_parcels %}
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>Tracking #</th>
            <th>Sender</th>
            <th>From</th>
            <th>To</th>
            <th>Status</th>
            <th>Created</th>
            <th>Delivered</th>
          </tr>
        </thead>
        <tbody>
          {% for parcel in received_parcels %}
          <tr>
            <td><code>{{ parcel.tracking_number }}</code></td>
            <td>{{ parcel.sender.first_name }} {{ parcel.sender.last_name }}</td>
            <td>{{ parcel.sender_office|default:"-" }}</td>
            <td>{{ parcel.receiver_office|default:"-" }}</td>
            <td>
              {% if parcel.current_status.code == "DELIVERED" %}
                <span class="badge bg-success">{{ parcel.current_status }}</span>
              {% elif parcel.current_status.code == "CANCELLED" or parcel.current_status.code == "RETURNED" %}
                <span class="badge bg-danger">{{ parcel.current_status }}</span>
              {% elif parcel.current_status.code == "IN_TRANSIT" or parcel.current_status.code == "OUT_FOR_DELIVERY" %}
                <span class="badge bg-primary">{{ parcel.current_status }}</span>
              {% else %}
                <span class="badge bg-secondary">{{ parcel.current_status }}</span>
              {% endif %}
            </td>
            <td>{{ parcel.created_at|date:"Y-m-d H:i" }}</td>
            <td>{{ parcel.delivered_at|date:"Y-m-d H:i"|default:"-" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="text-center text-muted py-4">
      <i class="bi bi-inbox fs-1 d-block mb-2"></i>
      <p class="mb-0">You haven't received any parcels yet.</p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
