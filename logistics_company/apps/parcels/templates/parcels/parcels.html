{% extends "base_app.html" %}

{% block title %}Parcels{% endblock %}
{% block page %}parcels{% endblock %}

{% block content %}
<header class="app-header">
  <h1>Parcels</h1>
  <p>Manage all shipments and deliveries</p>
</header>

<section class="card">
  <div class="card-header">
    <div>
      <div class="card-title">All Parcels</div>
      <div class="card-subtitle">View and manage all registered parcels</div>
    </div>
    <div style="display:flex;gap:12px;align-items:center;">
      <input
        id="parcelsSearch"
        class="search-input"
        placeholder="Search by tracking, sender, recipient..."
      />
      {% if can_register_parcel %}
        <button class="btn btn-primary" id="registerParcelBtn">
          + Register Parcel
        </button>
      {% endif %}
    </div>
  </div>

  <div class="table-wrapper">
    <table class="table">
      <thead>
        <tr>
          <th>Tracking #</th>
          <th>Sender</th>
          <th>Recipient</th>
          <th>Delivery</th>
          <th>Weight</th>
          <th>Price</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="parcelsTableBody"></tbody>
    </table>
  </div>

  <div
    id="parcelsCountInfo"
    style="font-size:12px; color: black; margin-top:8px;"
  ></div>
</section>

{% if can_register_parcel %}
<!-- Parcel Modal -->
<div id="parcelModal" class="modal" aria-hidden="true">
  <div class="modal-backdrop" data-close="1"></div>

  <div
    class="modal-card"
    role="dialog"
    aria-modal="true"
    aria-labelledby="parcelModalTitle"
  >
    <div class="modal-header">
      <div>
        <div id="parcelModalTitle" class="modal-title">
          Register Parcel
        </div>
        <div class="modal-subtitle">
          Create or edit a parcel
        </div>
      </div>
      <button
        class="btn-icon"
        id="parcelModalCloseBtn"
        title="Close"
      >
        ✖️
      </button>
    </div>

    <form id="parcelForm" class="modal-body">
      <input type="hidden" id="parcelId" />

      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">Tracking #</label>
          <input
            id="pTracking"
            class="form-control"
            placeholder="LT-2024-..."
            required
          />
        </div>

        <div class="form-group">
          <label class="form-label">Sender</label>
          <input
            id="pSender"
            class="form-control"
            placeholder="Sender name"
            required
          />
        </div>

        <div class="form-group">
          <label class="form-label">Recipient</label>
          <input
            id="pRecipient"
            class="form-control"
            placeholder="Recipient name"
            required
          />
        </div>

        <div class="form-group">
          <label class="form-label">Delivery Type</label>
          <select id="pDeliveryType" class="select" required>
            <option value="Address">Address</option>
            <option value="Office">Office</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Weight (kg)</label>
          <input
            id="pWeight"
            type="number"
            step="0.1"
            min="0"
            class="form-control"
            placeholder="e.g. 2.5"
            required
          />
        </div>

        <div class="form-group">
          <label class="form-label">Status</label>
          <select id="pStatus" class="select" required>
            <option value="Registered">Registered</option>
            <option value="In Transit">In Transit</option>
            <option value="Delivered">Delivered</option>
            <option value="Returned">Returned</option>
          </select>
        </div>

        <div class="form-group" id="ownerEmailGroup">
          <label class="form-label">Owner Email (client)</label>
          <input
            id="pOwnerEmail"
            type="email"
            class="form-control"
            placeholder="client@email.com"
          />
          <small
            style="color: black;display:block;margin-top:6px;"
          >
            Admin can assign parcel to a client.
          </small>
        </div>

        <div class="form-group">
          <label class="form-label">Price (auto)</label>
          <input id="pPrice" class="form-control" disabled />
          <small
            style="color: black;display:block;margin-top:6px;"
          >
            Calculated as: 5 + 2 × weight
          </small>
        </div>
      </div>

      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline"
          id="parcelCancelBtn"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          id="parcelSaveBtn"
        >
          Save
        </button>
      </div>
    </form>
  </div>
</div>
{% endif %}
{% endblock %}
